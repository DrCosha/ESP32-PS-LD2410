# ESP32-PS-LD2410
**Firware for ESP32s module with presence sensor HLK-LD2410.**

**Модуль присутствия/движения на ESP32s и модуле HLK-LD2410.**  

Позволяет обнаруживать движущиеся и неподвижные объекты на расстоянии до 5 метров. Датчик LD2410 может быть дополнительно настроен на различную чувствительность в зависимости от расстояния до объекта.
На плате есть дополнительный разъем OUT1, на который выведены выходы ключей с открытым коллектором, для подключения внешней перефирии.  Выходы Ext1 и Ext2 дублируют сигналы обнаружения подвижного и
неподвижного объекта в зоне обнаружения датчика.
Для сопряжения с системой "умного дома", модуль соединяется по WiFi с MQTT сервером. Настройки подключения прошиваются в подключаемом файле <local.h>. При отсутсвии этого файла, настройки могут быть взяты из 
основного тела программы (закомментированные строки).
Общение с датчиком через MQTT происходит через два топика [SET] и [STATUS]. В топике [STATUS] датчик рапортует о своём состоянии. Для режима ожидания - каждые 60 секунд. При обнаружении объекта - в момент события.
Общая тревога по датчику снимается через 120 секунд (тег "alert").  Последнее время задается в настройках модуля LD2410, и может быть настроено без программирования ESP32s.

Если модуль получает в топике [SET] команду {report}, то сразу публикует в топике [STATUS] своё текущее состояние. 

**Примеры сообщений:**

Для команды немедленного отчёта - топик [SET]:

__{"report"}__

При обнаружении объекта и движения - в топике [STATUS]:

__{"alert":"ON","moving":"ON","moving_distance":44,"moving_energy":100,"presence":"ON","presence_distance":57,"presence_energy":100}__

При ожидании - в топике [STATUS]:

__{"alert":"OFF","moving":"OFF","moving_distance":0,"moving_energy":0,"presence":"OFF","presence_distance":0,"presence_energy":0}__

Общая принципиальная схема модуля представлена ниже.

![Schematic_ESP32-PS-HLK-LD2410 rev1_2023-11-01](https://github.com/DrCosha/ESP32-PS-LD2410/assets/80087552/bc56a9ed-4f1f-4886-a324-9e1ee202fa6d)
